<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE aspectran PUBLIC "-//ASPECTRAN//DTD Aspectran 9.0//EN"
        "https://aspectran.com/dtd/aspectran-9.dtd">
<aspectran>

    <description style="apon">
        |
        |Use the command '{{GREEN}}undertow{{reset}}' to control the Undertow Server.
        |Since Undertow Server is running, have your web browser point to:
        |   {{81}}http://localhost:8080/todos{{reset}}
        |
        |Current profiles: #{currentEnvironment^currentProfiles}
        |
    </description>

    <bean id="basePath" class="com.aspectran.core.support.BasePathFactoryBean"/>
    <bean id="currentEnvironment" class="com.aspectran.core.support.CurrentEnvironmentFactoryBean"/>

    <!-- Default settings for all translets -->
    <aspect id="defaultTransletSettings">
        <joinpoint>
            pointcut: {
                +: /**
            }
        </joinpoint>
        <settings>
            <setting name="format.indentSize" value="2"/>
            <setting name="format.dateFormat" value="yyyy-MM-dd"/>
            <setting name="format.dateTimeFormat" value="yyyy-MM-dd HH:mm:ss"/>
            <setting name="format.nullWritable" value="true"/>
        </settings>
    </aspect>

    <!-- Default settings for web translets -->
    <aspect id="webTransletSettings">
        <joinpoint>
            pointcut: {
                +: /**
            }
        </joinpoint>
        <settings>
            <setting name="characterEncoding" value="utf-8"/>
            <setting name="viewDispatcher" value="thymeleafViewDispatcher"/>
            <setting name="proxyProtocolAware" value="true"/>
        </settings>
    </aspect>

    <!-- Thymeleaf Template Engine Configuration -->
    <bean id="thymeleaf" class="com.aspectran.thymeleaf.ThymeleafTemplateEngine">
        <argument>
            <bean class="com.aspectran.thymeleaf.TemplateEngineFactoryBean">
                <property name="templateResolvers" type="set">
                    <bean class="com.aspectran.thymeleaf.template.FileTemplateResolver">
                        <property name="prefix">#{basePath}/webapps/root/WEB-INF/templates/</property>
                        <property name="suffix">.html</property>
                        <property name="templateMode">HTML</property>
                        <property name="cacheable" valueType="boolean">false</property> <!-- For development -->
                    </bean>
                </property>
            </bean>
        </argument>
    </bean>

    <!-- Thymeleaf View Dispatcher Bean -->
    <bean id="thymeleafViewDispatcher" class="com.aspectran.thymeleaf.view.ThymeleafViewDispatcher">
        <argument>#{thymeleaf}</argument>
    </bean>

    <append file="/config/server/server.xml"/>

</aspectran>